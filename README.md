# ZapchastiMiraBot - Бот для поиска запчастей и продуктов компании "Торговый Дом Запчасти Мира"

## Описание

ZapchastiMiraBot — это Telegram-бот, разработанный для помощи клиентам компании "Торговый Дом Запчасти Мира" в поиске необходимых запчастей и продуктов. Бот предоставляет следующие возможности:

*   **Регистрация пользователей:** Бот позволяет новым пользователям зарегистрироваться, чтобы получить доступ к полному функционалу.
*   **Поиск по категориям:** Пользователи могут искать товары в двух основных категориях: "запчасти" и "продукты".
*   **Предоставление контактных данных:** Бот предоставляет контакты отдела продаж для получения дополнительной информации и консультаций.

Информация о товарах внесена в базу данных вручную, что обеспечивает актуальность и точность результатов поиска.

## Запуск через Docker

Для упрощения развертывания бота рекомендуется использовать Docker.  Вы можете собрать и запустить бота с помощью Docker и Docker Compose.

### Предварительные требования

Убедитесь, что у вас установлены Docker и Docker Compose.

### Шаги для запуска

1.  **Клонируйте репозиторий:**

    ```
    git clone <your_repository_url>
    cd ZapchastiMiraBot
    ```

2.  **Создайте файл `.env` на основе `.env_example`:**

    Скопируйте содержимое файла `.env_example` в новый файл `.env` и укажите необходимые значения переменных окружения.

    ```
    cp .env_example .env
    ```

    Отредактируйте файл `.env` и укажите актуальные значения для:

    *   `TELEGRAM_TOKEN`: Токен вашего Telegram бота, полученный от BotFather.
    *   `POSTGRES_HOST`: Хост базы данных PostgreSQL.
    *   `POSTGRES_PORT`: Порт базы данных PostgreSQL (по умолчанию 5432).
    *   `POSTGRES_USER`: Имя пользователя для подключения к базе данных PostgreSQL.
    *   `POSTGRES_PASSWORD`: Пароль для подключения к базе данных PostgreSQL.
    *   `POSTGRES_DB_NAME`: Имя базы данных PostgreSQL.

    Пример содержимого файла `.env`:

    ```
    TELEGRAM_TOKEN=YOUR_TELEGRAM_BOT_TOKEN
    POSTGRES_HOST=localhost
    POSTGRES_PORT=5432
    POSTGRES_USER=your_postgres_user
    POSTGRES_PASSWORD=your_postgres_password
    POSTGRES_DB_NAME=your_postgres_db
    ```

    **Замените `YOUR_TELEGRAM_BOT_TOKEN`, `your_postgres_user`, `your_postgres_password` и `your_postgres_db` на ваши реальные значения!**

    ⚠️ **Важно:** Не добавляйте файл `.env` в систему контроля версий (добавьте `.env` в файл `.gitignore`).

3.  **Соберите и запустите контейнеры с помощью Docker Compose:**

    ```
    docker-compose up --build
    ```

    Эта команда соберет необходимые Docker-образы и запустит бот и базу данных PostgreSQL в контейнерах.

## Локальный запуск (без Docker)

Для запуска бота локально (без использования Docker) необходимо выполнить следующие шаги:

1.  **Клонируйте репозиторий:**

    ```
    git clone <your_repository_url>
    cd ZapchastiMiraBot
    ```

2.  **Установите зависимости с помощью Poetry:**

    ```
    poetry install
    ```

    Эта команда установит все зависимости, перечисленные в вашем `pyproject.toml` файле, включая `sqlalchemy`, `alembic`, `pydantic`, `pydantic-settings`, `pytelegrambotapi` и `psycopg2-binary`. Poetry автоматически создаст и активирует виртуальное окружение, если это необходимо.

3.  **Настройте переменные окружения:**

    *   Создайте файл `.env` в корне проекта.
    *   Добавьте необходимые переменные окружения, которые используются для конфигурации бота. Эти переменные соответствуют настройкам, определенным в классах `TelegramSettings` и `PostgresSettings` (используются `pydantic-settings` для их загрузки). Пример файла `.env`:

        ```
        TELEGRAM_TOKEN=YOUR_TELEGRAM_BOT_TOKEN
        POSTGRES_HOST=localhost
        POSTGRES_PORT=5432
        POSTGRES_USER=your_postgres_user
        POSTGRES_PASSWORD=your_postgres_password
        POSTGRES_DB_NAME=your_postgres_db
        ```

        **Замените `YOUR_TELEGRAM_BOT_TOKEN`, `your_postgres_user`, `your_postgres_password` и `your_postgres_db` на ваши реальные значения!**
        Не забудьте указать актуальные данные для подключения к вашей базе данных PostgreSQL.

4.  **(Опционально) Активируйте shell Poetry:**

    ```
    poetry shell
    ```

    Эта команда активирует виртуальное окружение, созданное Poetry, в текущем shell. После этого вы можете запускать команды без необходимости явно указывать путь к интерпретатору Python в виртуальном окружении. Если вы не используете `poetry shell`, убедитесь, что вы запускаете `python` из виртуального окружения, созданного Poetry.

## Использование

1.  **Запустите бота:**

    ```
    python -m zapchastimira.interface.telegram
    ```

    Убедитесь, что вы запускаете эту команду в виртуальном окружении Poetry (либо активируйте его с помощью `poetry shell`, либо используйте полный путь к интерпретатору Python в виртуальном окружении).

2.  **Взаимодействуйте с ботом в Telegram:**

    *   Найдите бота в Telegram по имени пользователя: @ZapchastiMiraBot
    *   Запустите бота командой `/start`.
    *   Следуйте инструкциям бота для регистрации, поиска товаров и получения контактных данных.

### Примеры команд

*   `/start` - Запуск бота и отображение приветственного сообщения.
*   Поиск запчастей: Введите запрос, связанный с запчастями (например, "фильтры", "колодки", "тормозные диски").
*   Поиск продуктов: Введите запрос, связанный с продуктами (например, "домкраты", "компрессоры").
*   Получение контактов: Следуйте инструкциям бота для получения контактных данных отдела продаж.

### Настройка переменных окружения

Переменные окружения используются для конфигурации бота и подключения к внешним сервисам, таким как Telegram API и база данных PostgreSQL. Они соответствуют полям в классах `TelegramSettings` и `PostgresSettings`, которые используют `pydantic-settings` для автоматической загрузки значений из переменных окружения и файла `.env`.

*   `TELEGRAM_TOKEN`: Токен вашего Telegram бота, полученный от BotFather. Соответствует полю `token` в классе `TelegramSettings`. Определяется префиксом `TELEGRAM_` в настройках класса.
*   `POSTGRES_HOST`: Хост базы данных PostgreSQL. Соответствует полю `host` в классе `PostgresSettings`. Определяется префиксом `POSTGRES_` в настройках класса.
*   `POSTGRES_PORT`: Порт базы данных PostgreSQL (по умолчанию 5432). Соответствует полю `port` в классе `PostgresSettings`. Определяется префиксом `POSTGRES_` в настройках класса.
*   `POSTGRES_USER`: Имя пользователя для подключения к базе данных PostgreSQL. Соответствует полю `username` в классе `PostgresSettings`. Определяется префиксом `POSTGRES_` в настройках класса.
*   `POSTGRES_PASSWORD`: Пароль для подключения к базе данных PostgreSQL. Соответствует полю `password` в классе `PostgresSettings`. Определяется префиксом `POSTGRES_` в настройках класса. Рекомендуется хранить как `SecretStr` из соображений безопасности.
*   `POSTGRES_DB_NAME`: Имя базы данных PostgreSQL. Соответствует полю `db_name` в классе `PostgresSettings`. Определяется префиксом `POSTGRES_` в настройках класса.

**Важно:** Храните файл `.env` в безопасном месте и не добавляйте его в систему контроля версий (например, добавьте `.env` в файл `.gitignore`).